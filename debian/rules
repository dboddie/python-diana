#!/usr/bin/make -f

version = $(shell dpkg-parsechangelog | awk '/^Version/{print $$2}')

build:
	mkdir $(CURDIR)/debian/python-diana
	mkdir -p $(CURDIR)/debian/python-diana-examples/opt/qt4-headless/share/python-diana
	PYTHONPATH=/opt/qt4-headless/lib/python2.7/site-packages python configure.py
	$(MAKE)

clean:
	if [ ! -f Makefile ]; then PYTHONPATH=/opt/qt4-headless/lib/python2.7/site-packages python configure.py; fi
	$(MAKE) clean
	rm -rf $(CURDIR)/modules $(CURDIR)/debian/python-diana $(CURDIR)/debian/python-diana-examples $(CURDIR)/debian/files Makefile

install:
	$(MAKE) DESTDIR=$(CURDIR)/debian/python-diana install
	cp -a /usr/lib/libdiana.so* $(CURDIR)/debian/python-diana/opt/qt4-headless/lib
	cp -a examples $(CURDIR)/debian/python-diana-examples/opt/qt4-headless/share/python-diana

binary: binary-arch binary-indep

binary-indep:

binary-arch: install
	mkdir $(CURDIR)/debian/python-diana/DEBIAN
	dpkg-gencontrol -ppython-diana -P$(CURDIR)/debian/python-diana
	dpkg --build debian/python-diana ..
	mkdir $(CURDIR)/debian/python-diana-examples/DEBIAN
	dpkg-gencontrol -ppython-diana-examples -P$(CURDIR)/debian/python-diana-examples
	dpkg --build debian/python-diana-examples ..

.PHONY: build clean binary-indep binary-arch binary install configure

